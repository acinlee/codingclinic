{% extends "acincodingclinic/base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" type="text/css" href="{% static 'acincodingclinic/css/style.css' %}?after">
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.8/css/all.css">
<!--나눔 고딕-->
<link href="https://fonts.googleapis.com/css?family=Nanum+Gothic&display=swap" rel="stylesheet">
<!--오류 발생 알람메시지-->
{% if messages %}
    {% for message in messages %} 
        <script>alert("{{message}}");</script>
    {% endfor %}
{% endif %}
<!--알람 끝-->
<div class="container-fluid coachingmain" style="padding-bottom:7%;">
  <div class="row">
    <div class="col-md-1">
    </div>
    <div class="col-md-10">
      <label style="font-weight:600; font-size:42px; color:#4d4d4d; padding-top:3%; padding-bottom:2%;">마이페이지</label>
      <div class="form-group" style="background-color:white;">
        <div class="row">
          <div class="col-md-3" style="padding-top:3%; padding-left:6%;">
            <label style="font-weight:600; font-size:42px; color:#0174DF;">{{user_info.CDC_Name}}</label><label style="font-size:18px; padding-left:1%;">님 안녕하세요</label>
          </div>
          <div class="col-md-9">
            <a href="{%url 'acincodingclinic:codingclinic_info_page'%}"><img src="{% static 'acincodingclinic/img/design/mypagemoon.png'%}" style="position:relative; bottom:45%; left:45%; vartical-align:top;width:50%; height:100%;"></a>
          </div>
        </div>
        <div class="row" style="padding-top:5%; padding-bottom:10%;">
          <div class="col-md-4" style="text-align:right;">
            <a href="{% url 'acincodingclinic:mypage'%}"><img src="{% static 'acincodingclinic/img/design/userinfo.png'%}" style="width:50%; height:80%;"></a>
            <div style="padding-right:11%;">
              <label style="font-weight:600; font-size:23px;">회원정보 관리</label>
            </div>
          </div>
          <div class="col-md-4" style="text-align:center;">
            <a href="{% url 'acincodingclinic:mypage_usrcoaching'%}"><img src="{% static 'acincodingclinic/img/design/mycoaching.png'%}" style="width:50%; height:80%;"></a>
            <div>
              <label style="font-weight:600; font-size:23px;">나의 코칭 목록</label>
            </div>
          </div>
          <div class="col-md-4" style="text-align:left;">
            <a href="{% url 'acincodingclinic:mypage_usrpoing'%}"><img src="{% static 'acincodingclinic/img/design/point.png'%}" style="width:50%; height:80%;"></a>
            <div style="padding-left:20%;">
              <label style="font-weight:600; font-size:23px;">포인트</label>
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="margin-top:7%;">
        <div class="col-md-1">
        </div>
        <div class="col-md-2" style="background-color:white; text-align:center;">
          <a href="{% url 'acincodingclinic:mypage'%}" style="text-decoration:none !important;color:black;"><label style="font-size:30px; font-weight:600; padding-top:4%; padding-bottom:4%;">회원정보 관리</label></a>
        </div>
         <div class="col-md-2" style="text-align:center;">
          <a href="{% url 'acincodingclinic:mypage_usrcoaching'%}" style="text-decoration:none !important;color:black;"><label style="font-size:30px; font-weight:600; padding-top:4%; padding-bottom:4%;">나의 코칭</label></a>
        </div>
         <div class="col-md-2" style="text-align:center;">
          <a href="{% url 'acincodingclinic:mypage_usrpoing'%}" style="text-decoration:none !important;color:black;"><label style="font-size:30px; font-weight:600; padding-top:4%; padding-bottom:4%;">포인트 관리</label></a>
        </div>
        <div class="col-md-6">
        </div>
      </div>
	  <form name="formusrmodify" action="{% url 'acincodingclinic:personal_modify' %}" method="POST">
	  {% csrf_token %}
      <div class="form-group" style="background-color:white; font-size:23px; padding-bottom:7%;">
        <label style="font-weight:600; font-size:23px; color:#4d4d4d; padding-top:4%; padding-bottom:2%; padding-left:8%;">기본정보</label>
        <div id="mypage_id">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>아이디</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label>{{user_info.CDC_ID}}</label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_pw">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>비밀번호</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label><input type="password" id="pw_passrule" name="pw_passrule" style="width:100%; border-radius: 10px!important;" maxlength="15" value="{{user_info.CDC_PW}}"></label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_name">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>이름</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label>{{user_info.CDC_Name}}</label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_birth">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>생년월일</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label>{{usr_birth}}</label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_phone">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>전화번호</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label><input type="text" id="phone_modify" name="phone_modify"style="width:100%; border-radius: 10px!important;" value="{{user_info.CDC_PhoneNumber}}" maxlength="11" onKeyup="this.value=this.value.replace(/[^0-9]/g,'');"/></label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_job">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; background-color:#dee2e6;">
              <label>직업</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid;">
              <label>
			  	<select class="form-control" id="usr_job" name="usr_job" style="font-size:23px; border-radius: 10px!important;">
					<option value="{{user_info.get_CDC_job_display}}" selected>{{user_info.get_CDC_job_display}}</option>
					<option>초등학생</option>
					<option>중학생</option>
					<option>고등학생</option>
					<option>대학생</option>
					<option>직장인</option>
				</select>
			  </label>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div id="mypage_email">
          <div class="row">
            <div class="col-md-1">
            </div>
            <div class="col-md-2" style="padding-top:2%; padding-bottom:1.5%; text-align:center; border-top: 3px solid; border-bottom: 3px solid; background-color:#dee2e6;">
              <label>이메일</label>
            </div>
            <div class="col-md-8" style="padding-top:2%; padding-bottom:1.5%; text-align:left; border-top: 3px solid; border-bottom: 3px solid">
            	<input type="text" id="usr_modify_email" name="usr_modify_email" style="width:100%; border-radius: 10px!important;" onblur="email_check();" value="{{user_info.CDC_Email}}">
				<div id="email_right" style="font-size:11px; font-weight:600; display:none;" >
					<label style="color:#0081ff;">사용가능</label>
				</div>
				<div id="email_error" style="font-size:11px; font-weight:600; display:none;" >
					<label style="color:#ff0002; padding-right:7px;">사용불가</label>
				</div>
            </div>
            <div class="col-md-1">
            </div>
          </div>
        </div>
        <div class="row" style=" vertical-align:middle">
          <div class="col-md-4">
          </div>
          <div class="col-md-4" style="padding-top:2%; text-align:center;">
			<button type="button" class="btn btn-primary" style="width:30%; font-size:18px" onclick="UsrModifyCheck();">수정 완료</button>
          </div>
          <div class="col-md-4">
          </div>
      </div>
      </div>
	  </form>
    </div>
    <div class="col-md-1">
    </div>
  </div>
</div>
<script>
	function email_check(){
		//이메일 중복검사
		var email_right = document.getElementById('email_right');
		var email_error = document.getElementById('email_error');
		var usr_modify_email = $('#usr_modify_email').val();
		if ( usr_modify_email != ''){
			$.ajax({
					type : "POST",
					url : "{% url 'acincodingclinic:Usrmodify_emailcheck' %}",
					data : {
						'csrfmiddlewaretoken': '{{ csrf_token }}',
						'usr_modify_email' : usr_modify_email,
					},
					success : function(response)
					{
						if(response.msg == 'N')
						{
							email_check=false;
							email_error.style.display = 'block';
							email_right.style.display = 'none';
						}else{
							email_check=true;
							email_right.style.display = 'block';
							email_error.style.display = 'none';
						}
						
					},
				});
		}
		else{
			email_error.style.display = 'block';
			email_right.style.display = 'none';	
		}	
	}
	
	function UsrModifyCheck(){
		var pw_check=false;
		var email_check=false;

		//이메일 검사
		var email_right = document.getElementById('email_right');
		var email_error = document.getElementById('email_error');
		if (email_right.style.display=='block' || email_right.style.display=='none' && email_error.style.display=='none' ){
			email_check = true;
		}
		else{
			email_check = false;
		}

		//비밀번호 8자리 이상 15자리 이하 특수문자 영어 숫자 포함
		var passRule = /^.*(?=^.{8,15}$)(?=.*\d)(?=.*[a-zA-Z])(?=.*[!@#$%^&+=]).*$/;
		var pw_passrule = document.getElementById('pw_passrule');
		if(!passRule.test($('#pw_passrule').val())) {
			pw_check=false;
		}
		else{
			pw_check=true;
		}
	
		if(pw_check==true && email_check==true){
			document.formusrmodify.submit();
		}
		else{
			alert('양식을 다시확인해 주세요');
		}
	}
</script>
{% endblock %}
